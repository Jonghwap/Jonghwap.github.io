{% assign items = include.publications | default: site.publications %}
{% if items and items.size > 0 %}
{% assign has_order = items | where_exp: "p", "p.order" %}
{% if has_order and has_order.size == items.size %}
{% comment %}Respect manual ordering when every item provides an order field (higher numbers appear first).{% endcomment %}
{% assign sorted = items | sort: "order" | reverse %}
{% else %}
{% comment %}Fallback ordering: sort by title to stabilize, then by year (newest first).{% endcomment %}
{% assign sorted_by_title = items | sort: "title" %}
{% assign sorted = sorted_by_title | sort: "year" | reverse %}
{% endif %}
{% assign total = sorted.size %}
<ol class="publication-list">
  {% for pub in sorted %}
  <li class="publication-entry">
    <span class="publication-rank">#{{ total | minus: forloop.index0 }}</span>
    <div class="publication-details">
      <div class="publication-title">
        <strong>{{ pub.title }}</strong>
      </div>
      {% if pub.coauthors and pub.coauthors.size > 0 %}
      <div class="publication-coauthors">With {{ pub.coauthors | join: ", " }}</div>
      {% endif %}
      <div class="publication-meta">
        <em>{{ pub.journal }}</em>, {{ pub.year }}    
        {% assign has_journal_url = pub.journal_url and pub.journal_url != '' and pub.journal_url != empty %}
        {% assign has_arxiv = pub.arxiv and pub.arxiv != '' and pub.arxiv != empty %}
        {% if has_journal_url and has_arxiv %}        
        <span class="publication-links">    
          <a class="arxiv-button" href="{{ pub.arxiv }}" target="_blank" rel="noopener">arXiv</a>         
          <a class="journal-button" href="{{ pub.journal_url }}" target="_blank" rel="noopener">journal</a>        
        </span>
        {% elsif has_journal_url %}
        <span class="publication-links"><a class="journal-button" href="{{ pub.journal_url }}" target="_blank" rel="noopener">journal</a></span>
        {% elsif has_arxiv %}
        <span class="publication-links"><a class="arxiv-button" href="{{ pub.arxiv }}" target="_blank" rel="noopener">arXiv</a></span>        
        {% endif %}
      </div>    
    </div>
  </li>
  {% endfor %}
</ol>
{% else %}
<p>No publications have been added yet. Add entries under <code>_publications/</code> to list them.</p>
{% endif %}
